#!/bin/bash
if [ ! -d /home/vagrant/ghidra ]; then
  apt-get install -y \
    openjdk-11-jdk \
    unzip
  wget -O ghidra.zip https://ghidra-sre.org/ghidra_9.1.2_PUBLIC_20200212.zip
  mkdir ghidra
  unzip ./ghidra.zip -d ghidra 2> /dev/null
  mkdir -p /home/vagrant/.local/share/applications
  cat | tee /home/vagrant/.local/share/applications/ghidra.desktop <<EOF
[Desktop Entry]
Categories=Application;Development;
Comment[en_US]=Ghidra Software Reverse Engineering Suite
Comment=Ghidra Software Reverse Engineering Suite
Exec=/home/vagrant/ghidra/ghidra_9.1.2_PUBLIC/ghidraRun
GenericName[en_US]=Ghidra Software Reverse Engineering Suite
GenericName=Ghidra Software Reverse Engineering Suite
Icon=/home/vagrant/ghidra/ghidra_9.1.2_PUBLIC/support/ghidra.ico
MimeType=
Name[en_US]=Ghidra 9.0
Name=Ghidra 9.0
Path=home/vagrant/ghidra/ghidra_9.1.2_PUBLIC/
StartupNotify=false
Terminal=false
TerminalOptions=
Type=Application
Version=1.0
X-DBUS-ServiceName=
X-DBUS-StartupType=none
X-KDE-SubstituteUID=false
X-KDE-Username=
EOF
  chown -R vagrant: /home/vagrant/ghidra
  chown vagrant: /home/vagrant/.local/share/applications/ghidra.desktop
  chmod +x /home/vagrant/.local/share/applications/ghidra.desktop
fi
